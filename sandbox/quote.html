<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Get a Quote - DigitizeThisPhoto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="favicon.ico" type="image/x-icon"> 
    <link rel="stylesheet" href="style.css"> 
    <style>
        /* Override section max-width from style.css for better form flow */
        .section {
            max-width: 800px;
            margin: 3rem auto;
        }
        /* Specific styles for the two-sided option */
        .radio-group {
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 1rem;
        }
        .radio-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .section h3 {
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        .price-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #003366;
            margin-top: 1rem;
        }
        /* Form navigation buttons */
        .form-nav button {
            margin-right: 1rem;
        }
        .form-nav {
            margin-top: 2rem;
        }
    </style>
</head>
<body>
  <header>
    <h1>digitizethisphoto</h1>
    <p>Preserve Your Memories – Professional Photo Scanning</p>
  </header>
  <nav>
    <a href="index.html#services">Services</a>
    <a href="index.html#gallery">Gallery</a>
    <a href="quote.html">Quote & Contact</a>
  </nav>

  <div class="section">
    <h2>Get Your Free Digitizing Quote</h2>
    <p>Complete the steps below to get your personalized pricing.</p>

    <form id="quoteForm" class="contact-form" onsubmit="return false;"> 

        <div id="step1">
            <h3>Step 1: Contact & Photo Details</h3>
            <label for="first-name">First Name</label>
            <input type="text" id="first-name" name="first_name" required>

            <label for="last-name">Last Name</label>
            <input type="text" id="last-name" name="last_name" required>

            <label for="email">Your Email Address</label>
            <input type="email" id="email" name="email" required>

            <label for="phone">Phone Number (Optional)</label>
            <input type="text" id="phone" name="phone">

            <label for="quantity-select">Select Quantity Range</label>
            <select id="quantity-select" name="quantity_range" required onchange="updatePriceDisplay()">
                <option value="" disabled selected>Select a range</option>
                <option value="1-50">1-50 photos (Flat Rate)</option>
                <option value="51-100">51-100 photos</option>
                <option value="101-200">101-200 photos</option>
                <option value="201-300">201-300 photos</option>
            </select>
            
            <p style="margin-top: 1.5rem;">**Photo Scan Details**</p>
            <label for="estimated-count">Enter Estimated Photo Count (For accurate calculation)</label>
            <input type="number" id="estimated-count" name="estimated_count" min="1" required oninput="updatePriceDisplay()">

            <div class="radio-group">
                <label>Do you need two-sided scanning? (+ $0.05 per photo)</label>
                <label><input type="radio" name="two_sided" value="No" checked onchange="updatePriceDisplay()"> No</label>
                <label><input type="radio" name="two_sided" value="Yes" onchange="updatePriceDisplay()"> Yes</label>
            </div>
            
            <div class="price-display">
                Current Price Estimate: <span id="current-price">$0.00</span>
            </div>

            <div class="form-nav">
                <button type="button" class="cta-btn" onclick="nextStep(1)">Continue to Step 2</button>
            </div>
        </div>

        <div id="step2" style="display:none;">
            <h3>Step 2: Digital Delivery Method</h3>
            <div class="radio-group">
                <label>How would you like to receive your digital photos?</label>
                <label><input type="radio" name="delivery_method" value="USB" required onchange="updatePriceDisplay()"> Option 1: USB Stick (Add $10.00)</label>
                <label><input type="radio" name="delivery_method" value="Download" onchange="updatePriceDisplay()"> Option 2: Secure Download Link (Add $5.00)</label>
            </div>

            <div class="price-display">
                Updated Price Estimate: <span id="updated-price-2">$0.00</span>
            </div>
            
            <div class="form-nav">
                <button type="button" class="cta-btn" onclick="prevStep(2)" style="background: #ccc; color: #222;">Back to Step 1</button>
                <button type="button" class="cta-btn" onclick="nextStep(2)">Continue to Review</button>
            </div>
        </div>

        <div id="step3" style="display:none;">
            <h3>Step 3: Final Quote Summary</h3>
            
            <div id="summary-output" class="radio-group">
                </div>

            <div class="price-display">
                **FINAL TOTAL: <span id="final-price-output">$0.00</span>**
            </div>
            
            <div class="form-nav">
                <button type="button" class="cta-btn" onclick="prevStep(3)" style="background: #ccc; color: #222;">Back to Step 2</button>
                <button type="submit" class="cta-btn" onclick="generateAndSubmit()">Submit Quote & Order</button>
            </div>
        </div>
    </form>
  </div>

  <footer>
    digitizethisphoto © 2025 | Scanning your past for the future.
  </footer>

<script>
    // --- JAVASCRIPT LOGIC FOR DYNAMIC PRICING AND STEPS ---
    
    // Price structure for calculating the per-photo rate
    const PRICE_RATES = {
        '1-50': { rate: 0, flat: 45.00 }, // Flat price override
        '51-100': { rate: 0.40, flat: 0 },
        '101-200': { rate: 0.35, flat: 0 },
        '201-300': { rate: 0.30, flat: 0 },
    };
    const TWO_SIDED_FEE = 0.05;
    const DELIVERY_RATES = {
        'USB': 10.00,
        'Download': 5.00,
        'None': 0.00
    };

    let finalQuotePrice = 0; // Variable to hold the final calculated price

    function calculatePrice() {
        const range = document.getElementById('quantity-select').value;
        let count = parseInt(document.getElementById('estimated-count').value);
        const twoSided = document.querySelector('input[name="two_sided"]:checked').value;
        const deliveryMethod = document.querySelector('input[name="delivery_method"]:checked')?.value || 'None';
        
        if (!range || isNaN(count) || count <= 0) {
            return 0.00;
        }

        const pricing = PRICE_RATES[range];
        let baseRate = pricing.rate;
        let totalCost = 0;
        let perPhotoRate = 0;

        // 1. Calculate base photo scanning cost
        if (range === '1-50') {
            totalCost = pricing.flat;
            perPhotoRate = 0; // Flat fee, rate not applicable
        } else {
            perPhotoRate = baseRate;
            totalCost = count * baseRate;
        }

        // 2. Add two-sided fee if selected
        if (twoSided === 'Yes') {
            perPhotoRate += TWO_SIDED_FEE;
            // Recalculate based on the new per-photo rate, only if not flat rate
            if (range !== '1-50') {
                 totalCost = count * perPhotoRate;
            } else {
                // If flat rate, apply the fee to the flat rate
                totalCost += (count * TWO_SIDED_FEE);
            }
        }
        
        // 3. Add delivery cost
        const deliveryCost = DELIVERY_RATES[deliveryMethod];
        totalCost += deliveryCost;
        
        return parseFloat(totalCost.toFixed(2));
    }

    function updatePriceDisplay() {
        const price = calculatePrice();
        const priceDisplay = document.getElementById('current-price');
        const priceDisplay2 = document.getElementById('updated-price-2');
        const finalPriceDisplay = document.getElementById('final-price-output');
        
        priceDisplay.textContent = `$${price.toFixed(2)}`;
        priceDisplay2.textContent = `$${price.toFixed(2)}`;
        finalPriceDisplay.textContent = `$${price.toFixed(2)}`;
        finalQuotePrice = price;
    }

    function nextStep(currentStep) {
        const form = document.getElementById('quoteForm');
        let isValid = true;

        // Basic validation for current step fields
        const currentDiv = document.getElementById(`step${currentStep}`);
        const requiredInputs = currentDiv.querySelectorAll('[required]');
        
        requiredInputs.forEach(input => {
            if (!input.value || (input.type === 'radio' && !document.querySelector(`input[name="${input.name}"]:checked`))) {
                isValid = false;
                input.reportValidity(); // Show native browser error message
            }
        });

        if (currentStep === 1 && (!document.getElementById('estimated-count').value || isNaN(parseInt(document.getElementById('estimated-count').value)) || document.getElementById('quantity-select').value === "")) {
             isValid = false;
        }
        
        if (isValid) {
            document.getElementById(`step${currentStep}`).style.display = 'none';
            document.getElementById(`step${currentStep + 1}`).style.display = 'block';
            if (currentStep + 1 === 3) {
                generateSummary();
            }
        }
    }

    function prevStep(currentStep) {
        document.getElementById(`step${currentStep}`).style.display = 'none';
        document.getElementById(`step${currentStep - 1}`).style.display = 'block';
    }

    function generateSummary() {
        const form = document.getElementById('quoteForm');
        const formData = new FormData(form);
        const summaryOutput = document.getElementById('summary-output');
        let summaryHTML = '<h3>Review Details:</h3>';
        
        // Detailed summary variables
        const range = formData.get('quantity_range');
        const count = parseInt(formData.get('estimated_count'));
        const pricing = PRICE_RATES[range];
        let baseRate = pricing.rate;
        const twoSided = formData.get('two_sided');
        const delivery = formData.get('delivery_method');
        const deliveryCost = DELIVERY_RATES[delivery];

        // Recalculate final rate for display
        let finalRatePerPhoto = baseRate;
        let pricingDetail = "";

        if (range === '1-50') {
            pricingDetail = `Flat Fee of $${pricing.flat.toFixed(2)}`;
            if (twoSided === 'Yes') {
                 pricingDetail += ` plus $${TWO_SIDED_FEE.toFixed(2)}/photo two-sided fee.`;
            }
        } else {
             if (twoSided === 'Yes') {
                 finalRatePerPhoto += TWO_SIDED_FEE;
             }
             pricingDetail = `$${finalRatePerPhoto.toFixed(2)} per photo`;
        }

        // Build HTML summary
        summaryHTML += `<p><strong>Name:</strong> ${formData.get('first_name')} ${formData.get('last_name')}</p>`;
        summaryHTML += `<p><strong>Email:</strong> ${formData.get('email')}</p>`;
        summaryHTML += `<p><strong>Phone:</strong> ${formData.get('phone') || 'N/A'}</p>`;
        summaryHTML += `<p><strong>Estimated Photos:</strong> ${count} photos (${range})</p>`;
        summaryHTML += `<p><strong>Scanning Rate:</strong> ${pricingDetail}</p>`;
        summaryHTML += `<p><strong>Two-Sided Scan:</strong> ${twoSided}</p>`;
        summaryHTML += `<p><strong>Delivery Method:</strong> ${delivery} (Cost: $${deliveryCost.toFixed(2)})</p>`;
        
        summaryOutput.innerHTML = summaryHTML;
        updatePriceDisplay(); // Final price update
    }

    function generateAndSubmit() {
        const quoteNumber = generateQuoteNumber();
        const formData = new FormData(document.getElementById('quoteForm'));
        
        // 1. Generate PDF (using print function for simplicity)
        // For a true PDF, a library (like jsPDF) or server-side code is needed.
        // For this example, we generate a printable summary and trigger the browser's print function.
        const pdfContent = generatePDFOutput(formData, quoteNumber);
        
        // Temporarily open new window for printing/PDF
        const printWindow = window.open('', '_blank');
        printWindow.document.write(pdfContent);
        printWindow.document.close();
        printWindow.print();
        
        // 2. Generate mailto link
        const emailBody = encodeURIComponent(
            `Quote Details (Quote #${quoteNumber}):\n\n` +
            `Name: ${formData.get('first_name')} ${formData.get('last_name')}\n` +
            `Email: ${formData.get('email')}\n` +
            `Phone: ${formData.get('phone') || 'N/A'}\n` +
            `Quantity: ${formData.get('estimated_count')} photos (${formData.get('quantity_range')})\n` +
            `Two-Sided: ${formData.get('two_sided')}\n` +
            `Delivery: ${formData.get('delivery_method')}\n\n` +
            `FINAL PRICE: $${finalQuotePrice.toFixed(2)}`
        );
        
        const mailtoLink = `mailto:jeffik@jeffik.com?subject=Photo%20Scan%20Quote%23${quoteNumber}&body=${emailBody}`;
        
        // Open the user's email client
        window.location.href = mailtoLink;

        // Prevent standard form submission
        return false;
    }

    function generateQuoteNumber() {
        // Simple 6-digit number generation based on current time
        return Math.floor(Date.now() / 1000).toString().slice(-6);
    }
    
    // Function to create the printable/PDF output content
    function generatePDFOutput(formData, quoteNumber) {
        let pdfHTML = `
            <html>
            <head>
                <title>Quote #${quoteNumber}</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 40px; }
                    h1 { color: #003366; border-bottom: 2px solid #eee; padding-bottom: 10px; }
                    p { line-height: 1.6; }
                    .summary-box { border: 1px solid #ccc; padding: 20px; border-radius: 8px; margin-top: 20px; }
                    .final-price { font-size: 24px; font-weight: bold; color: #cc0000; margin-top: 20px; }
                </style>
            </head>
            <body>
                <h1>Photo Scanning Quote Summary</h1>
                <p><strong>Quote Number: #${quoteNumber}</strong></p>
                <div class="summary-box">
                    <h3>Client & Order Details</h3>
                    <p><strong>Client Name:</strong> ${formData.get('first_name')} ${formData.get('last_name')}</p>
                    <p><strong>Client Email:</strong> ${formData.get('email')}</p>
                    <p><strong>Estimated Count:</strong> ${formData.get('estimated_count')} photos</p>
                    <p><strong>Quantity Range:</strong> ${formData.get('quantity_range')}</p>
                    <p><strong>Two-Sided Scan:</strong> ${formData.get('two_sided')}</p>
                    <p><strong>Delivery Method:</strong> ${formData.get('delivery_method')}</p>
                </div>
                <div class="final-price">
                    FINAL PRICE: $${finalQuotePrice.toFixed(2)}
                </div>
                <p>This document serves as your estimated price quote. Prices are subject to final photo count verification.</p>
            </body>
            </html>
        `;
        return pdfHTML;
    }
    
    // Initial display update
    document.addEventListener('DOMContentLoaded', updatePriceDisplay);
</script>
</body>
</html>